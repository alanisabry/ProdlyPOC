<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>60.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>Assign_Order_fields</name>
        <label>Assign - Order fields</label>
        <locationX>567</locationX>
        <locationY>475</locationY>
        <assignmentItems>
            <assignToReference>varOpportunityRecord.Sales_Order_Generated__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Sub_Flow_Opportunity_to_Order.oOppty.Sales_Order_Generated__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varOpportunityRecord.Products_being_merged__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Sub_Flow_Opportunity_to_Order.oOppty.Products_being_merged__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Decision_Type_is_Referral</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Renewal_Generated_Details</name>
        <label>Assign - Renewal Generated Details</label>
        <locationX>594</locationX>
        <locationY>1075</locationY>
        <assignmentItems>
            <assignToReference>varOpportunityRecord.Products_Renewed__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varOpportunityRecord.Renew_Products_Name__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>varOpportunityRecord.current_user__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varOpportunityRecord.Renew_Products_Timestamp__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varOpportunityRecord.Next_Renewal_Opportunity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Sub_Flow_Create_Renewal.VarT_NewOpportunityId</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Decision_Add_Upsell_Products_to_Renewal</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Update_Referral_Fields</name>
        <label>Assign - Update Referral Fields</label>
        <locationX>819</locationX>
        <locationY>826</locationY>
        <assignmentItems>
            <assignToReference>varOpportunityRecord.Closed_Won_Finance__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varOpportunityRecord.Products_Renewed__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Decision_Create_Renewal</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Upsell_to_Renewal_Merged_Details</name>
        <label>Assign - Upsell to Renewal Merged Details</label>
        <locationX>545</locationX>
        <locationY>1423</locationY>
        <assignmentItems>
            <assignToReference>varOpportunityRecord.Products_Renewed__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varOpportunityRecord.Renew_Products_Name__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>varOpportunityRecord.current_user__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varOpportunityRecord.Renew_Products_Timestamp__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varOpportunityRecord.Renew_Products_Failed__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varOpportunityRecord.Products_being_merged_to_renewal__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Sub_Flow_Add_Upsell_to_Renewal.Upsell_Opp.Products_being_merged_to_renewal__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varOpportunityRecord.Next_Renewal_Opportunity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Sub_Flow_Add_Upsell_to_Renewal.Upsell_Opp.Next_Renewal_Opportunity__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Opportunity</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Decision_Add_Upsell_Products_to_Renewal</name>
        <label>Decision - Add Upsell Products to Renewal</label>
        <locationX>170</locationX>
        <locationY>1152</locationY>
        <defaultConnector>
            <targetReference>Update_Opportunity</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Yes_Add_Upsell_Products_to_Renewal</name>
            <conditionLogic>(1 OR (4 AND 5)) AND 2 AND 3</conditionLogic>
            <conditions>
                <leftValueReference>varOpportunityRecord.Type</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Existing Business-Upsell</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varOpportunityRecord.Products_Renewed__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varOpportunityRecord.Products_being_merged_to_renewal__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varOpportunityRecord.Type</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Existing Business - Internal Transfer</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varOpportunityRecord.Upsell_Internal_Transfer_Opp__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Sub_Flow_Add_Upsell_to_Renewal</targetReference>
            </connector>
            <label>Yes - Add Upsell Products to Renewal</label>
        </rules>
    </decisions>
    <decisions>
        <name>Decision_Create_Renewal</name>
        <label>Decision - Create Renewal?</label>
        <locationX>169</locationX>
        <locationY>753</locationY>
        <defaultConnector>
            <targetReference>Decision_Add_Upsell_Products_to_Renewal</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Yes_Create_renewal</name>
            <conditionLogic>5 and (1 or 2 or 3 or (4 AND 7) or 6)</conditionLogic>
            <conditions>
                <leftValueReference>varOpportunityRecord.Type</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>New Business-Enterprise Cloud</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varOpportunityRecord.Type</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Existing Business-Renewal</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varOpportunityRecord.Type</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>New Business - Expansion Portal</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varOpportunityRecord.Type</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Existing Business - Internal Transfer</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varOpportunityRecord.Products_Renewed__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varOpportunityRecord.Type</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Existing Business - Platform Transfer</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varOpportunityRecord.Upsell_Internal_Transfer_Opp__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Sub_Flow_Create_Renewal</targetReference>
            </connector>
            <label>Yes - Create renewal</label>
        </rules>
    </decisions>
    <decisions>
        <name>Decision_Generate_Orders</name>
        <label>Decision - Generate Orders?</label>
        <locationX>169</locationX>
        <locationY>214</locationY>
        <defaultConnector>
            <targetReference>Decision_Create_Renewal</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Yes_Generate_Orders</name>
            <conditionLogic>1 and (2 or 3 or ((NOT(4) or 8) and 7)) and (4 OR 6) and 5 AND (9 OR 10)</conditionLogic>
            <conditions>
                <leftValueReference>varOpportunityRecord.Sales_Order_Generated__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varOpportunityRecord.MRR__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varOpportunityRecord.One_off__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varOpportunityRecord.Type</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Existing Business - Internal Transfer</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varOpportunityRecord.Products_being_merged__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varOpportunityRecord.Upsell_Internal_Transfer_Opp__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varOpportunityRecord.of_products_MRR__c</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varOpportunityRecord.Type</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Existing Business-Upsell</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varOpportunityRecord.Type</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Referral</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varOpportunityRecord.Create_Referral_Order__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Sub_Flow_Opportunity_to_Order</targetReference>
            </connector>
            <label>Yes - Generate Orders</label>
        </rules>
    </decisions>
    <decisions>
        <name>Decision_Type_is_Referral</name>
        <label>Decision - Type is Referral?</label>
        <locationX>666</locationX>
        <locationY>637</locationY>
        <defaultConnector>
            <targetReference>Decision_Create_Renewal</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Yes_Type_is_referral</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>varOpportunityRecord.Type</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Referral</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Update_Referral_Fields</targetReference>
            </connector>
            <label>Yes - Type is referral</label>
        </rules>
    </decisions>
    <description>BODEV-4533 Tracing New Pricing Deals
Updated the flow to pass to value for &quot;Opportunity with value-based pricing&quot; field - Renewal</description>
    <environments>Default</environments>
    <formulas>
        <name>frmNewPackageName</name>
        <dataType>String</dataType>
        <expression>TEXT({!varOpportunityRecord.Standard_Package_Name__c})</expression>
    </formulas>
    <formulas>
        <name>frmOLDOpportunityName</name>
        <dataType>String</dataType>
        <expression>UPPER(LEFT({!varOpportunityRecord.Name},2)) + &quot; -&quot; +IF({!varOpportunityRecord.OEM__c} = &quot;0010P00001xSOyuQAG&quot;,&quot;Workfront OEM - &quot;,IF({!varOpportunityRecord.OEM__c} = &quot;0010P00001xSHsb&quot;,&quot;Acquia OEM - &quot;,&quot; &quot;)) + {!varOpportunityRecord.Account.Name} + &quot; - Contract &quot; +TEXT( {!varOpportunityRecord.Account.of_New_Business_Renewals__c} + 1 - {!varOpportunityRecord.Account.Ex_customer_of_new_business_renewals__c} )</expression>
    </formulas>
    <formulas>
        <name>frmPartnerName</name>
        <dataType>String</dataType>
        <expression>IF(ISBLANK({!varOpportunityRecord.OEM__c}),&quot;&quot;,{!varOpportunityRecord.OEM__r.Name})</expression>
    </formulas>
    <interviewLabel>Opportunity [ALF] Invoked: Renewals Order Upsell to Renewal {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Opportunity [ALF] Invoked: Renewals Order Upsell to Renewal</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordUpdates>
        <name>Update_Opportunity</name>
        <label>Update - Opportunity</label>
        <locationX>175</locationX>
        <locationY>1600</locationY>
        <inputReference>varOpportunityRecord</inputReference>
    </recordUpdates>
    <start>
        <locationX>50</locationX>
        <locationY>50</locationY>
        <connector>
            <targetReference>Decision_Generate_Orders</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <subflows>
        <name>Sub_Flow_Add_Upsell_to_Renewal</name>
        <label>Sub Flow - Add Upsell to Renewal</label>
        <locationX>544</locationX>
        <locationY>1246</locationY>
        <connector>
            <targetReference>Assign_Upsell_to_Renewal_Merged_Details</targetReference>
        </connector>
        <flowName>Add_Upsell_to_Renewal</flowName>
        <inputAssignments>
            <name>VarT_UpsellOpportunityId</name>
            <value>
                <elementReference>varOpportunityRecord.Id</elementReference>
            </value>
        </inputAssignments>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </subflows>
    <subflows>
        <name>Sub_Flow_Create_Renewal</name>
        <label>Sub Flow - Create Renewal</label>
        <locationX>469</locationX>
        <locationY>893</locationY>
        <connector>
            <targetReference>Assign_Renewal_Generated_Details</targetReference>
        </connector>
        <flowName>Create_Renewal_Opportunity</flowName>
        <inputAssignments>
            <name>AccountId</name>
            <value>
                <elementReference>varOpportunityRecord.AccountId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>OwnerId</name>
            <value>
                <elementReference>varOpportunityRecord.OwnerId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Salesoffice</name>
            <value>
                <elementReference>varOpportunityRecord.Sales_Office__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Var_PPaymentPeriod</name>
            <value>
                <elementReference>varOpportunityRecord.Payment_Period__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>VarB_Package_Selected</name>
            <value>
                <elementReference>varOpportunityRecord.MM_Standardised_Package__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>VarC_OldMRR</name>
            <value>
                <elementReference>varOpportunityRecord.MRR__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>VarD_ContractEndDate</name>
            <value>
                <elementReference>varOpportunityRecord.End_date_contract__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>VarD_NewCloseDate</name>
            <value>
                <elementReference>varOpportunityRecord.NewCloseDate__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>VarN_InvoicePeriod</name>
            <value>
                <elementReference>varOpportunityRecord.Invoice_period__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>VarN_NoticePeriod</name>
            <value>
                <elementReference>varOpportunityRecord.Notice_period_months__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>VarN_RenewalTerm</name>
            <value>
                <elementReference>varOpportunityRecord.Contract_Renewal_Term__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>VarT_AccountId</name>
            <value>
                <elementReference>varOpportunityRecord.AccountId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>VarT_Contract</name>
            <value>
                <elementReference>varOpportunityRecord.ContractId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>VarT_Currency</name>
            <value>
                <elementReference>varOpportunityRecord.CurrencyIsoCode</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>VarT_OEM</name>
            <value>
                <elementReference>varOpportunityRecord.OEM__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>VarT_OldOpportunityId</name>
            <value>
                <elementReference>varOpportunityRecord.Opportunity_ID_18_digits__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>VarT_OldOpportunityName</name>
            <value>
                <elementReference>frmOLDOpportunityName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>VarT_OpportunityType</name>
            <value>
                <elementReference>varOpportunityRecord.Type</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>VarT_PartnerName</name>
            <value>
                <elementReference>frmPartnerName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>VarT_PricebookId</name>
            <value>
                <elementReference>varOpportunityRecord.Pricebook2Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>varT_PriceUplift</name>
            <value>
                <elementReference>varOpportunityRecord.Account.Price_Uplift_On_Renewal__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>VarT_RecordTypeID</name>
            <value>
                <elementReference>varOpportunityRecord.RecordTypeId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>VarT_Source</name>
            <value>
                <elementReference>varOpportunityRecord.Source__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>VarT_Stage</name>
            <value>
                <elementReference>varOpportunityRecord.StageName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>VarT_Standard_Package</name>
            <value>
                <elementReference>frmNewPackageName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ValuebasedPricingInfo</name>
            <value>
                <elementReference>varOpportunityRecord.Opportunity_with_value_based_pricing__c</elementReference>
            </value>
        </inputAssignments>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </subflows>
    <subflows>
        <name>Sub_Flow_Opportunity_to_Order</name>
        <label>Sub Flow - Opportunity to Order</label>
        <locationX>453</locationX>
        <locationY>295</locationY>
        <connector>
            <targetReference>Assign_Order_fields</targetReference>
        </connector>
        <flowName>Opportunity_to_Order</flowName>
        <inputAssignments>
            <name>OpptyID</name>
            <value>
                <elementReference>varOpportunityRecord.Id</elementReference>
            </value>
        </inputAssignments>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </subflows>
    <variables>
        <name>varOpportunityRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Opportunity</objectType>
    </variables>
</Flow>
