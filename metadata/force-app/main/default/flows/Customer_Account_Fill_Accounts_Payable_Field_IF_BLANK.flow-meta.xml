<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>60.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <decisions>
        <name>Accounts_Payable_Is_Blank</name>
        <label>Accounts Payable Is Blank?</label>
        <locationX>182</locationX>
        <locationY>539</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Accounts_Payable_is_Blank_true</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Credit_Control_Reminder_Email__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Accounts_Payable_Email_Value</targetReference>
            </connector>
            <label>Accounts Payable is Blank</label>
        </rules>
    </decisions>
    <decisions>
        <name>PO_Requester_Is_Blank</name>
        <label>PO Requester Is Blank?</label>
        <locationX>336</locationX>
        <locationY>323</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>PO_Requester_is_Blank_True</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.PO_Requestor__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_PO_Requester_Email_Value</targetReference>
            </connector>
            <label>PO Requester is Blank</label>
        </rules>
    </decisions>
    <description>BODEV-3304
This flow will be triggered when an Account Type is changed to Customer while the Accounts Payable Email field is BLANK
Adding PO Requester field to the logic as per Michael&apos;s request</description>
    <environments>Default</environments>
    <formulas>
        <description>This formula will be used to concatenate the Billing to Contact Email with the Billing CC Email having a comma as a separator between the two values</description>
        <name>BillingEmailsStringConcatenation</name>
        <dataType>String</dataType>
        <expression>IF(
    ISBLANK({!$Record.Bill_to_Contact_Email__c}) &amp;&amp; ISBLANK({!$Record.Billing_cc_email__c}),
    &quot;&quot;,
    IF(ISBLANK({!$Record.Bill_to_Contact_Email__c}), {!$Record.Billing_cc_email__c},
        IF(ISBLANK({!$Record.Billing_cc_email__c}), {!$Record.Bill_to_Contact_Email__c},
            {!$Record.Bill_to_Contact_Email__c} &amp; &quot;, &quot; &amp; {!$Record.Billing_cc_email__c}
        )
    )
)</expression>
    </formulas>
    <interviewLabel>Customer Account - Fill Accounts Payable Field IF BLANK {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Customer Account - Fill Accounts Payable Field IF BLANK</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordUpdates>
        <description>Update Accounts Payable Email using the following fields:
1. Bill to Contact Email
2. Billing CC Email</description>
        <name>Update_Accounts_Payable_Email_Value</name>
        <label>Update Accounts Payable Email Value</label>
        <locationX>50</locationX>
        <locationY>647</locationY>
        <inputAssignments>
            <field>Credit_Control_Reminder_Email__c</field>
            <value>
                <elementReference>BillingEmailsStringConcatenation</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <description>Update PO Requester Email using the following fields:
1. Bill to Contact Email
2. Billing CC Email</description>
        <name>Update_PO_Requester_Email_Value</name>
        <label>Update PO Requester Email Value</label>
        <locationX>182</locationX>
        <locationY>431</locationY>
        <connector>
            <targetReference>Accounts_Payable_Is_Blank</targetReference>
        </connector>
        <inputAssignments>
            <field>PO_Requestor__c</field>
            <value>
                <elementReference>BillingEmailsStringConcatenation</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <start>
        <locationX>210</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>PO_Requester_Is_Blank</targetReference>
        </connector>
        <filterLogic>(5 OR (1 AND 2)) AND (3 OR 4)</filterLogic>
        <filters>
            <field>Type</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Type</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Customer</stringValue>
            </value>
        </filters>
        <filters>
            <field>Credit_Control_Reminder_Email__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>PO_Requestor__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Bill_to_Contact_Email__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <object>Account</object>
        <recordTriggerType>Update</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
</Flow>
