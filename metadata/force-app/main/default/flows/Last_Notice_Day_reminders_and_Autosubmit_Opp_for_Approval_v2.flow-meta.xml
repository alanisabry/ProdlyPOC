<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Closed_Notification</name>
        <label>Closed Notification</label>
        <locationX>340</locationX>
        <locationY>906</locationY>
        <actionName>chatterPost</actionName>
        <actionType>chatterPost</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>text</name>
            <value>
                <stringValue>Hi @[{!Account.CSM_Owner__c}], This renewal opportunity has been submitted for approval automatically as the last notice day has passed and this account is on automatic renewal.</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>subjectNameOrId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>chatterPost</nameSegment>
    </actionCalls>
    <actionCalls>
        <description>Notify opportunity owner when decision maker or champion contacts are missing on account</description>
        <name>Contacts_missing_notification</name>
        <label>Contacts missing notification</label>
        <locationX>337</locationX>
        <locationY>319</locationY>
        <actionName>Opportunity.Notify_opp_owner_when_decision_maker_or_champion_contacts_are_missing_on_account</actionName>
        <actionType>emailAlert</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>Opportunity.Notify_opp_owner_when_decision_maker_or_champion_contacts_are_missing_on_account</nameSegment>
    </actionCalls>
    <actionCalls>
        <name>Notify_CSM_on_applying_pricing_factors</name>
        <label>Notify CSM on applying pricing factors</label>
        <locationX>2010</locationX>
        <locationY>1669</locationY>
        <actionName>chatterPost</actionName>
        <actionType>chatterPost</actionType>
        <connector>
            <targetReference>Clear_Cumulative_indexation_on_account</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>text</name>
            <value>
                <elementReference>Day30ReminderMessage</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>subjectNameOrId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>chatterPost</nameSegment>
    </actionCalls>
    <actionCalls>
        <name>Submit_for_QA_Approval</name>
        <label>Submit for QA Approval</label>
        <locationX>339</locationX>
        <locationY>730</locationY>
        <actionName>submit</actionName>
        <actionType>submit</actionType>
        <connector>
            <targetReference>Closed_Notification</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>objectId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>submitterId</name>
            <value>
                <elementReference>$Record.OwnerId</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>processDefinitionNameOrId</name>
            <value>
                <stringValue>04a3g000000KyjC</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>skipEntryCriteria</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <nameSegment>submit</nameSegment>
    </actionCalls>
    <actionCalls>
        <name>X30_Day_Reminder</name>
        <label>30 Day Reminder</label>
        <locationX>588</locationX>
        <locationY>1204</locationY>
        <actionName>chatterPost</actionName>
        <actionType>chatterPost</actionType>
        <connector>
            <targetReference>Update_renewal_Opp_0</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>subjectNameOrId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>text</name>
            <value>
                <stringValue>#[Renewal Close Date] Hi @[{!Account.CSM_Owner__c}],  This account is on automatic renewal and in 30 days it will be the last day for them to cancel the renewal. If for any reason, the auto-renewal for this specific opportunity should be stopped, please check the “Stop automatic renewal”-checkbox. Otherwise, this renewal will be set to closed won after {!$Record.Last_Notice_Day__c}</stringValue>
            </value>
        </inputParameters>
        <nameSegment>chatterPost</nameSegment>
    </actionCalls>
    <actionCalls>
        <name>X30_Day_Reminder_0</name>
        <label>30 Day Reminder</label>
        <locationX>803</locationX>
        <locationY>320</locationY>
        <actionName>chatterPost</actionName>
        <actionType>chatterPost</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>subjectNameOrId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>text</name>
            <value>
                <stringValue>#[Renewal Close Date] Hi @[{!Account.CSM_Owner__c}],  This account is on automatic renewal and in 30 days it will be the last day for them to cancel the renewal. If for any reason, the auto-renewal for this specific opportunity should be stopped, please check the “Stop automatic renewal”-checkbox. Otherwise, this renewal will be set to closed won after {!$Record.Last_Notice_Day__c}</stringValue>
            </value>
        </inputParameters>
        <nameSegment>chatterPost</nameSegment>
    </actionCalls>
    <actionCalls>
        <name>X3_Day_Reminder_1</name>
        <label>3 Day Reminder 1</label>
        <locationX>508</locationX>
        <locationY>648</locationY>
        <actionName>chatterPost</actionName>
        <actionType>chatterPost</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>subjectNameOrId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>text</name>
            <value>
                <stringValue>#[Renewal Close Date] Hi @[{!Account.CSM_Owner__c}],  There are three days left until the final notice date of this renewal. If for any reason, the auto-renewal for this specific opportunity should be stopped, please check the “Stop automatic renewal”-checkbox.</stringValue>
            </value>
        </inputParameters>
        <nameSegment>chatterPost</nameSegment>
    </actionCalls>
    <apiVersion>55.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>Add_Indexation_Rates</name>
        <label>Add Indexation Rates</label>
        <locationX>1384</locationX>
        <locationY>823</locationY>
        <assignmentItems>
            <assignToReference>SumofIndexationRates</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Indexation_Rates.Indexation_Rate__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>LoopCount</assignToReference>
            <operator>Add</operator>
            <value>
                <numberValue>1.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Indexation_Rates</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_movements</name>
        <label>Add movements</label>
        <locationX>1043</locationX>
        <locationY>1771</locationY>
        <assignmentItems>
            <assignToReference>IndexationMovementsAmount</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_movements.Amount__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_movements</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_OLI_values</name>
        <label>Assign OLI values</label>
        <locationX>1815</locationX>
        <locationY>1448</locationY>
        <assignmentItems>
            <assignToReference>Loop_products.Default_Price__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>updatedOLIDefaultPrice</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>Loop_products.Sales_Price_ARR__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>UpdatedOLISalesPrice</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>Loop_products.Pricing_factors_applied_on_OLI__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>updatedRenewalOLIList</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_products</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_products</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Opp_values</name>
        <label>Assign Opp values</label>
        <locationX>1296</locationX>
        <locationY>1458</locationY>
        <assignmentItems>
            <assignToReference>$Record.Applied_Cumulative_Indexation__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Account.Cumulative_Indexation__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.Applied_Upcoming_Indexation__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>currentIndexationRate</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.Pricing_factors_applied__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.Price_Uplift_On_Renewal__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Account.Price_Uplift_On_Renewal__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.Price_Uplift_on_Renewal_percentage__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Account.Price_Uplift_on_Renewal_percentage__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_renewal_Opp</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_previous_indexation_reported</name>
        <label>Assign previous indexation reported</label>
        <locationX>1296</locationX>
        <locationY>1718</locationY>
        <assignmentItems>
            <assignToReference>$Record.Indexation_reported_in_previous_contract__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>IndexationMovementsAmount</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Assign_Opp_values</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Variable_Rate</name>
        <label>Assign Variable Rate</label>
        <locationX>2117</locationX>
        <locationY>1008</locationY>
        <assignmentItems>
            <assignToReference>VariableIndexationRate</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Cap_Indexation_Rate__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Check_changes_to_pricing</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Variable_Rate_0</name>
        <label>Assign Variable Rate</label>
        <locationX>1942</locationX>
        <locationY>913</locationY>
        <assignmentItems>
            <assignToReference>VariableIndexationRate</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>AvgIndexationRate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Check_changes_to_pricing</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Check_changes_to_pricing</name>
        <label>Check changes to pricing?</label>
        <locationX>769</locationX>
        <locationY>988</locationY>
        <defaultConnector>
            <targetReference>Get_Previous_Indexation_Movements</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Yes</defaultConnectorLabel>
        <rules>
            <name>No</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CumulativeIndexation</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>UpcomingIndexation</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>RenewalUplift</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>X30_Day_Reminder</targetReference>
            </connector>
            <label>No</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_if_cap_indexation_rate_exists</name>
        <label>Check if cap indexation rate exists?</label>
        <locationX>1804</locationX>
        <locationY>632</locationY>
        <defaultConnector>
            <targetReference>Assign_Variable_Rate_0</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Cap_exists</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Cap_Indexation_Rate__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Cap_Indexation_Rate__c</leftValueReference>
                <operator>LessThan</operator>
                <rightValue>
                    <elementReference>AvgIndexationRate</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Variable_Rate</targetReference>
            </connector>
            <label>Cap % exists</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_if_movements_exist</name>
        <label>Check if movements exist?</label>
        <locationX>1038</locationX>
        <locationY>1454</locationY>
        <defaultConnector>
            <targetReference>Assign_Opp_values</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Exist</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Previous_Indexation_Movements</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_movements</targetReference>
            </connector>
            <label>Exist</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_if_rates_exist</name>
        <label>Check if rates exist?</label>
        <locationX>1275</locationX>
        <locationY>633</locationY>
        <defaultConnector>
            <targetReference>Check_changes_to_pricing</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Rates_exist</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Indexation_Rates</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_Indexation_Rates</targetReference>
            </connector>
            <label>Rates exist</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_Indexation</name>
        <label>Check Indexation?</label>
        <locationX>764</locationX>
        <locationY>631</locationY>
        <defaultConnector>
            <targetReference>Check_changes_to_pricing</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Variable</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Account.Indexation__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Account.Indexation_Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Variable</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Indexation_Rates</targetReference>
            </connector>
            <label>Variable</label>
        </rules>
    </decisions>
    <decisions>
        <name>Clear_Cumulative_indexation_on_account</name>
        <label>Clear Cumulative indexation on account?</label>
        <locationX>1858</locationX>
        <locationY>1838</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Remove</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Account.Cumulative_Indexation__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Account</targetReference>
            </connector>
            <label>Remove</label>
        </rules>
    </decisions>
    <decisions>
        <name>Notice_Day</name>
        <label>Notice Day</label>
        <locationX>332</locationX>
        <locationY>561</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>X30</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Last_Notice_Day__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>TodayPlus30</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Pricing_factors_applied</targetReference>
            </connector>
            <label>30</label>
        </rules>
        <rules>
            <name>X7</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Last_Notice_Day__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>TodayPlus7</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Account.IsDecisionMakerandChampionadded__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Contacts_missing_notification</targetReference>
            </connector>
            <label>7</label>
        </rules>
        <rules>
            <name>X3</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Last_Notice_Day__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>TodayPlus3</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>X3_Day_Reminder_1</targetReference>
            </connector>
            <label>3</label>
        </rules>
        <rules>
            <name>X1</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Last_Notice_Day__c</leftValueReference>
                <operator>LessThanOrEqualTo</operator>
                <rightValue>
                    <elementReference>TodayMinus1</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Submit_for_QA_Approval</targetReference>
            </connector>
            <label>Today - 1</label>
        </rules>
    </decisions>
    <decisions>
        <name>Pricing_factors_applied</name>
        <label>Pricing factors applied?</label>
        <locationX>510</locationX>
        <locationY>385</locationY>
        <defaultConnector>
            <targetReference>Check_Indexation</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Not Applied</defaultConnectorLabel>
        <rules>
            <name>Applied</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Pricing_factors_applied__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>X30_Day_Reminder_0</targetReference>
            </connector>
            <label>Applied</label>
        </rules>
    </decisions>
    <description>BODEV-2760: Updated the logic used to calculate the default price of the product by applying the threshold(2%) on upcoming indexation.</description>
    <environments>Default</environments>
    <formulas>
        <name>AvgIndexationRate</name>
        <dataType>Number</dataType>
        <expression>{!SumofIndexationRates}/{!LoopCount}</expression>
        <scale>1</scale>
    </formulas>
    <formulas>
        <name>CumulativeIndexation</name>
        <dataType>Currency</dataType>
        <expression>IF(ISBLANK({!Account.Cumulative_Indexation__c}),
       0,
        {!Account.Cumulative_Indexation__c}/100*{!$Record.Initial_Default_Price_ARR__c}
)</expression>
        <scale>8</scale>
    </formulas>
    <formulas>
        <name>currentIndexationRate</name>
        <dataType>Number</dataType>
        <expression>IF(TEXT({!Account.Indexation_Type__c})=&apos;&apos;,0,
IF(TEXT({!Account.Indexation_Type__c}) = &apos;Fixed&apos;,{!Account.Fixed_Indexation_Rate__c}, 
{!VariableIndexationRate} 
)
)</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>indexationAvgEndDate</name>
        <dataType>Date</dataType>
        <expression>/* For orders before 2023, indexation rate should be average of Jan-Dec rates
From 2023, indexation rate should be average of Aug-Jul rates */
IF(YEAR({!$Record.Startdate_contract__c}) &gt;=2023,
DATE(YEAR({!$Record.Startdate_contract__c})-1,VALUE({!$Label.IndexationAvgEndMonth}),01),
DATE(YEAR({!$Record.Startdate_contract__c})-1,VALUE(&apos;12&apos;),01)
)</expression>
    </formulas>
    <formulas>
        <name>indexationAvgStartDate</name>
        <dataType>Date</dataType>
        <expression>/* For orders before 2023, indexation rate should be average of Jan-Dec rates
From 2023, indexation rate should be average of Aug-Jul rates */
IF(YEAR({!$Record.Startdate_contract__c}) &gt;= 2023,
DATE(YEAR({!$Record.Startdate_contract__c})-2,VALUE({!$Label.IndexationAvgStartMonth}),01),
DATE(YEAR({!$Record.Startdate_contract__c})-1,VALUE(&apos;01&apos;),01)
)</expression>
    </formulas>
    <formulas>
        <description>If the current indexation rate (Fixed/Variable) is more than 2%, the threshold of 2% should be applied to the default price of the product.</description>
        <name>IndexationThreshold</name>
        <dataType>Number</dataType>
        <expression>IF({!currentIndexationRate} &gt; 2, 2,{!currentIndexationRate})</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>OLICumulativeIndexation</name>
        <dataType>Currency</dataType>
        <expression>IF({!CumulativeIndexation}!=0,
      {!Loop_products.Initial_Default_Price_ARR_One_off__c}*{!Account.Cumulative_Indexation__c}/100,
       0
)</expression>
        <scale>8</scale>
    </formulas>
    <formulas>
        <name>OLIIndexationThresholdForDefaultPrice</name>
        <dataType>Currency</dataType>
        <expression>IF({!UpcomingIndexation}!=0,
      ({!Loop_products.Initial_Default_Price_ARR_One_off__c}+{!OLICumulativeIndexation})*{!IndexationThreshold}/100,
      0
)</expression>
        <scale>8</scale>
    </formulas>
    <formulas>
        <name>OLIRenewalUplift</name>
        <dataType>Currency</dataType>
        <expression>IF({!RenewalUplift}!=0,
      ({!Loop_products.Initial_Default_Price_ARR_One_off__c}+{!OLICumulativeIndexation}+{!OLIUpcomingIndexation})* 
        {!Account.Price_Uplift_on_Renewal_percentage__c}/100,
        0
)</expression>
        <scale>8</scale>
    </formulas>
    <formulas>
        <name>OLIUpcomingIndexation</name>
        <dataType>Currency</dataType>
        <expression>IF({!UpcomingIndexation}!=0,
      ({!Loop_products.Initial_Default_Price_ARR_One_off__c}+{!OLICumulativeIndexation})*{!currentIndexationRate}/100,
      0
)</expression>
        <scale>8</scale>
    </formulas>
    <formulas>
        <name>RenewalUplift</name>
        <dataType>Currency</dataType>
        <expression>IF(TEXT({!Account.Price_Uplift_On_Renewal__c}) = &apos;Yes&apos;,
   {!Account.Price_Uplift_on_Renewal_percentage__c}/100*
   IF({!CumulativeIndexation}!=0&amp;&amp; {!UpcomingIndexation}!=0,
       ({!$Record.Initial_Default_Price_ARR__c}+{!CumulativeIndexation}+{!UpcomingIndexation}),
       IF({!CumulativeIndexation}!=0,
            ({!$Record.Initial_Default_Price_ARR__c}+{!CumulativeIndexation}),
            IF({!UpcomingIndexation}!=0,
               ({!$Record.Initial_Default_Price_ARR__c}+{!UpcomingIndexation}),{!$Record.Initial_Default_Price_ARR__c})
          )
       ),
    0
   )</expression>
        <scale>8</scale>
    </formulas>
    <formulas>
        <name>TodayMinus1</name>
        <dataType>Date</dataType>
        <expression>TODAY() - 1</expression>
    </formulas>
    <formulas>
        <name>TodayPlus3</name>
        <dataType>Date</dataType>
        <expression>TODAY()+3</expression>
    </formulas>
    <formulas>
        <name>TodayPlus30</name>
        <dataType>Date</dataType>
        <expression>TODAY()+30</expression>
    </formulas>
    <formulas>
        <name>TodayPlus7</name>
        <dataType>Date</dataType>
        <expression>TODAY()+7</expression>
    </formulas>
    <formulas>
        <name>UpcomingIndexation</name>
        <dataType>Currency</dataType>
        <expression>IF(TEXT({!$Record.Waive_Indexation__c}) =&apos;Yes&apos; || TEXT({!$Record.Waive_Indexation__c}) =&apos;First Year&apos;,
     0,
     IF(TEXT({!Account.Indexation__c}) = &apos;Yes&apos; || TEXT({!Account.Indexation__c}) =&apos;After Initial Term&apos;, 
               IF(ISBLANK({!Account.Cumulative_Indexation__c}), 
                     {!currentIndexationRate}/100*{!$Record.Initial_Default_Price_ARR__c},
                      {!currentIndexationRate}/100*({!$Record.Initial_Default_Price_ARR__c}+{!CumulativeIndexation})
                     ),
           0
)
)</expression>
        <scale>8</scale>
    </formulas>
    <formulas>
        <name>updatedOLIDefaultPrice</name>
        <dataType>Currency</dataType>
        <expression>{!Loop_products.Initial_Default_Price_ARR_One_off__c}/12+{!OLICumulativeIndexation}/12+{!OLIIndexationThresholdForDefaultPrice}/12</expression>
        <scale>8</scale>
    </formulas>
    <formulas>
        <name>UpdatedOLISalesPrice</name>
        <dataType>Currency</dataType>
        <expression>{!Loop_products.Initial_Default_Price_ARR_One_off__c}+{!OLICumulativeIndexation}+{!OLIUpcomingIndexation}+{!OLIRenewalUplift}</expression>
        <scale>8</scale>
    </formulas>
    <interviewLabel>Last Notice Day reminders and Autosubmit Opp for Approval v2 {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Last Notice Day reminders and Autosubmit Opp for Approval v2</label>
    <loops>
        <name>Loop_Indexation_Rates</name>
        <label>Loop Indexation Rates</label>
        <locationX>1456</locationX>
        <locationY>626</locationY>
        <collectionReference>Get_Indexation_Rates</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Add_Indexation_Rates</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Check_if_cap_indexation_rate_exists</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_movements</name>
        <label>Loop movements</label>
        <locationX>1041</locationX>
        <locationY>1588</locationY>
        <collectionReference>Get_Previous_Indexation_Movements</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Add_movements</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Assign_previous_indexation_reported</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_products</name>
        <label>Loop products</label>
        <locationX>1813</locationX>
        <locationY>1273</locationY>
        <collectionReference>renewalProducts</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_OLI_values</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Update_Renewal_OLI</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Account</name>
        <label>Account</label>
        <locationX>175</locationX>
        <locationY>559</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Notice_Day</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.AccountId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Account</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>CSM_Owner__c</queriedFields>
        <queriedFields>Cumulative_Indexation__c</queriedFields>
        <queriedFields>Indexation__c</queriedFields>
        <queriedFields>Indexation_Type__c</queriedFields>
        <queriedFields>Current_Indexation_Rate__c</queriedFields>
        <queriedFields>Price_Uplift_On_Renewal__c</queriedFields>
        <queriedFields>Price_Uplift_on_Renewal_percentage__c</queriedFields>
        <queriedFields>Fixed_Indexation_Rate__c</queriedFields>
        <queriedFields>IsDecisionMakerandChampionadded__c</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Indexation_Rates</name>
        <label>Get Indexation Rates</label>
        <locationX>1069</locationX>
        <locationY>538</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Check_if_rates_exist</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Subsidiary__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Account.Subsidiary_lookup__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Indexation_Rate__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <numberValue>0.0</numberValue>
            </value>
        </filters>
        <filters>
            <field>Indexation_Rate__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Indexation_First_Date__c</field>
            <operator>GreaterThanOrEqualTo</operator>
            <value>
                <elementReference>indexationAvgStartDate</elementReference>
            </value>
        </filters>
        <filters>
            <field>Indexation_First_Date__c</field>
            <operator>LessThanOrEqualTo</operator>
            <value>
                <elementReference>indexationAvgEndDate</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Indexation_Rate__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Opp_Products</name>
        <label>Get Opp Products</label>
        <locationX>1635</locationX>
        <locationY>1274</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_products</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>OpportunityId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <object>OpportunityLineItem</object>
        <outputReference>renewalProducts</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Default_Price__c</queriedFields>
        <queriedFields>UnitPrice</queriedFields>
        <queriedFields>Sales_Price_ARR__c</queriedFields>
        <queriedFields>Default_Price_ARR__c</queriedFields>
        <queriedFields>Original_Price_ARR_OneOff__c</queriedFields>
        <queriedFields>Original_Price__c</queriedFields>
        <queriedFields>Quantity</queriedFields>
        <queriedFields>Initial_Default_Price_ARR_One_off__c</queriedFields>
        <queriedFields>Pricing_factors_applied_on_OLI__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Previous_Indexation_Movements</name>
        <label>Get Previous Indexation Movements</label>
        <locationX>1046</locationX>
        <locationY>1122</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Check_if_movements_exist</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Opportunity__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Previous_Contract__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Movement_Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Indexation</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Active</stringValue>
            </value>
        </filters>
        <filters>
            <field>Order__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Opportunity_ARR_Movement__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_Account</name>
        <label>Update Account</label>
        <locationX>1722</locationX>
        <locationY>2008</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.AccountId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Cumulative_Indexation__c</field>
        </inputAssignments>
        <object>Account</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Renewal_OLI</name>
        <label>Update Renewal OLI</label>
        <locationX>2010</locationX>
        <locationY>1458</locationY>
        <connector>
            <targetReference>Notify_CSM_on_applying_pricing_factors</targetReference>
        </connector>
        <inputReference>updatedRenewalOLIList</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_renewal_Opp</name>
        <label>Update renewal Opp</label>
        <locationX>1296</locationX>
        <locationY>1274</locationY>
        <connector>
            <targetReference>Get_Opp_Products</targetReference>
        </connector>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_renewal_Opp_0</name>
        <label>Update renewal Opp</label>
        <locationX>589</locationX>
        <locationY>1419</locationY>
        <inputAssignments>
            <field>Pricing_factors_applied__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <start>
        <locationX>48</locationX>
        <locationY>50</locationY>
        <connector>
            <targetReference>Account</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Flow_Last_Notice_Day__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <object>Opportunity</object>
        <schedule>
            <frequency>Daily</frequency>
            <startDate>2020-01-06</startDate>
            <startTime>06:15:00.000Z</startTime>
        </schedule>
        <triggerType>Scheduled</triggerType>
    </start>
    <status>Active</status>
    <textTemplates>
        <name>Day30ReminderMessage</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>#[Renewal Close Date] Hi @[{!Account.CSM_Owner__c}],          
                                                This account is on automatic renewal and in 30 days it will be the last day for them to cancel the renewal.  If for any reason, the auto-renewal for this specific opportunity should be stopped, please check the “Stop automatic renewal”-checkbox.  Otherwise, this renewal will be set to closed won after {!$Record.Last_Notice_Day__c}. 

Pricing factors also had been applied on the renewal, please check the values on the opportunity. If the pricing factors has to be changed, re-apply the factors by clicking on the &apos;Apply Pricing Factors&apos; button on opportunity.</text>
    </textTemplates>
    <variables>
        <name>IndexationMovementsAmount</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>8</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>LoopCount</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>renewalProducts</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <name>SumofIndexationRates</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
    </variables>
    <variables>
        <name>updatedRenewalOLIList</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <name>VariableIndexationRate</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
</Flow>
