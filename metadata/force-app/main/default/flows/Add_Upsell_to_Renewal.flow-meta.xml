<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Upsell_to_renewal_failed_email_alert</name>
        <label>Upsell to renewal failed email alert</label>
        <locationX>750</locationX>
        <locationY>868</locationY>
        <actionName>Opportunity.Upsell_to_renewal_failed</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>Products_Renewed</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>VarT_UpsellOpportunityId</elementReference>
            </value>
        </inputParameters>
        <nameSegment>Opportunity.Upsell_to_renewal_failed</nameSegment>
    </actionCalls>
    <apiVersion>52.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <description>Add a product to the collection that will be deleted after loop has ended.</description>
        <name>Add_to_OLI_Delete</name>
        <label>Add to OLI Delete</label>
        <locationX>1823</locationX>
        <locationY>509</locationY>
        <assignmentItems>
            <assignToReference>OLI_to_Delete</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>LV_Renewal_OLI</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Counter_Plus_One</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Assigns updated product to the collection of products to be updated that later will be updated after the loop has ended.</description>
        <name>Add_to_OLI_to_Update</name>
        <label>Add to OLI to Update</label>
        <locationX>1587</locationX>
        <locationY>698</locationY>
        <assignmentItems>
            <assignToReference>OLI_to_Update</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>LV_Renewal_OLI</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Counter_Plus_One</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>All_in_One</name>
        <label>All in One</label>
        <locationX>1050</locationX>
        <locationY>26</locationY>
        <assignmentItems>
            <assignToReference>CV_NewOLI</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>NEWOLI</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Upsell_OLI</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_data_into_new_SObject_Variables</name>
        <label>Assign data into new SObject Variables</label>
        <locationX>1586</locationX>
        <locationY>28</locationY>
        <assignmentItems>
            <assignToReference>NEWOLI.UnitPrice</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>OLISalesPrice</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>NEWOLI.Quantity</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>LV_Upsell_OLI.Quantity</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>NEWOLI.OpportunityId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Renewal_Opp.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>NEWOLI.PricebookEntryId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>LV_Upsell_OLI.PricebookEntryId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>NEWOLI.Recurring_Discount__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue></stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>NEWOLI.Auto_Created__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>NEWOLI.Description</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>LV_Upsell_OLI.Description</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>NEWOLI.Upsell_OLI_ID_18_digits__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>LV_Upsell_OLI.Line_Item_ID_18_digits__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>NEWOLI.Default_Price__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>OLISalesPrice</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>NEWOLI.Sales_Price_ARR__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>OLISalesPriceARR</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>NEWOLI.Block_dependent_product__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>NEWOLI.Original_Price__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ABS_Sales_Price</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>NEWOLI.Part_of_Min_Commit__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>LV_Upsell_OLI.Part_of_Min_Commit__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>NEWOLI.Initial_Purchased_Price_ARR__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>LV_Upsell_OLI.Sales_Price_ARR__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>All_in_One</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Renewal_Quantity</name>
        <label>Assign Renewal Quantity</label>
        <locationX>2061</locationX>
        <locationY>700</locationY>
        <assignmentItems>
            <assignToReference>LV_Renewal_OLI.Quantity</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>NewQuantity</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>LV_Renewal_OLI.Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>LV_Renewal_OLI.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>LV_Renewal_OLI.UnitPrice</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>LV_Renewal_OLI.UnitPrice</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>LV_Renewal_OLI.Sales_Price_ARR__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>LV_Renewal_OLI.Sales_Price_ARR__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_to_OLI_to_Update</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Blank_Update_Counter</name>
        <label>Blank Update Counter</label>
        <locationX>1228</locationX>
        <locationY>189</locationY>
        <assignmentItems>
            <assignToReference>UpdateCounter</assignToReference>
            <operator>Assign</operator>
            <value>
                <numberValue>0.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Upsell_OLI</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Products_Being_Merged</name>
        <label>Products Being Merged</label>
        <locationX>526</locationX>
        <locationY>486</locationY>
        <assignmentItems>
            <assignToReference>Upsell_Opp.Products_being_merged_to_renewal__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>Upsell_Opp.Next_Renewal_Opportunity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Renewal_Opp.Opportunity_ID_18_digits__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Renewal_Products</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Products_Being_Merged_0</name>
        <label>Products Being Merged</label>
        <locationX>1254</locationX>
        <locationY>1189</locationY>
        <assignmentItems>
            <assignToReference>Upsell_Opp.Products_being_merged_to_renewal__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </assignmentItems>
    </assignments>
    <assignments>
        <name>Products_Renewed</name>
        <label>Products Renewed</label>
        <locationX>750</locationX>
        <locationY>1041</locationY>
        <assignmentItems>
            <assignToReference>Upsell_Opp.Products_Renewed__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>Upsell_Opp.Renew_Products_Failed__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
    </assignments>
    <assignments>
        <name>Update_Counter_Plus_One</name>
        <label>Update Counter Plus One</label>
        <locationX>1586</locationX>
        <locationY>508</locationY>
        <assignmentItems>
            <assignToReference>UpdateCounter</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Updatecounterplus1</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Renewal_OLI</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Contains_MRR</name>
        <label>Contains MRR?</label>
        <locationX>485</locationX>
        <locationY>673</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Decision_Contains_MRR</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CV_Upsell_OLI</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Related_Renewal_IsClosed</targetReference>
            </connector>
            <label>Contains MRR</label>
        </rules>
    </decisions>
    <decisions>
        <name>OLIs_to_delete</name>
        <label>OLIs to delete?</label>
        <locationX>1046</locationX>
        <locationY>871</locationY>
        <defaultConnector>
            <targetReference>Update_Renewal</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Yes_Delete</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>OLI_to_Delete</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Delete_OLIs</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Product_Check</name>
        <label>Product Check</label>
        <locationX>2047</locationX>
        <locationY>329</locationY>
        <defaultConnector>
            <targetReference>Loop_Renewal_OLI</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Same_Product_and_Unit_Price</name>
            <conditionLogic>1 AND 2 AND 3 AND (4 OR 5) AND 6</conditionLogic>
            <conditions>
                <leftValueReference>LV_Renewal_OLI.PricebookEntryId</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>LV_Upsell_OLI.PricebookEntryId</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>UpdateCounter</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>LV_Renewal_OLI.Part_of_a_package__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>NonRecurringDiscountMergeCondition</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>RecurringDiscountMergeCondition</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>UpsellOLIMinCommit</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>RenewalOLIMinCommit</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Quantity_Zero</targetReference>
            </connector>
            <label>Same Product and Unit Price</label>
        </rules>
    </decisions>
    <decisions>
        <name>Products_being_merged_check</name>
        <label>Products being merged check</label>
        <locationX>180</locationX>
        <locationY>360</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>No_interview</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Upsell_Opp.Products_being_merged_to_renewal__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Related_Renewal</targetReference>
            </connector>
            <label>No interview</label>
        </rules>
    </decisions>
    <decisions>
        <name>Products_Updated</name>
        <label>Products Updated?</label>
        <locationX>1580</locationX>
        <locationY>200</locationY>
        <defaultConnector>
            <targetReference>Blank_Update_Counter</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>No_products_updated</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>UpdateCounter</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_data_into_new_SObject_Variables</targetReference>
            </connector>
            <label>No products updated</label>
        </rules>
    </decisions>
    <decisions>
        <name>Quantity_Zero</name>
        <label>Quantity Zero</label>
        <locationX>2053</locationX>
        <locationY>503</locationY>
        <defaultConnector>
            <targetReference>Assign_Renewal_Quantity</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>No_Products</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>NewQuantity</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Add_to_OLI_Delete</targetReference>
            </connector>
            <label>No Products</label>
        </rules>
    </decisions>
    <decisions>
        <name>Related_Renewal_IsClosed</name>
        <label>Related Renewal IsClosed?</label>
        <locationX>737</locationX>
        <locationY>673</locationY>
        <defaultConnectorLabel>[Default Outcome]</defaultConnectorLabel>
        <rules>
            <name>Yes</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>Renewal_Opp.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Closed Won</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Renewal_Opp.StageName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Closed Lost</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Renewal_Opp</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Upsell_to_renewal_failed_email_alert</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
        <rules>
            <name>No</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Renewal_Opp.Contract_IsActive__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>True_Allow_Product_Merge_Update</targetReference>
            </connector>
            <label>No</label>
        </rules>
    </decisions>
    <description>BODEV-2680 Build - Min Commit controls 
Updated the Flow to compare &amp; merge upsell products based on Minimum Commit checkbox along with other conditions</description>
    <environments>Default</environments>
    <formulas>
        <name>ABS_Sales_Price</name>
        <dataType>Currency</dataType>
        <expression>ABS({!LV_Upsell_OLI.UnitPrice})</expression>
        <scale>8</scale>
    </formulas>
    <formulas>
        <description>Returns the price that the upsell OLI should have after it is merged. If discount is recurring, then the price is Sales Price; if not, then the Sales Price after merging should be equal to Default Price.</description>
        <name>cur_PriceAfterMergingProduct</name>
        <dataType>Currency</dataType>
        <expression>IF(TEXT({!LV_Upsell_OLI.Recurring_Discount__c}) = &quot;Yes&quot;, {!LV_Upsell_OLI.UnitPrice}, {!LV_Upsell_OLI.Default_Price__c})</expression>
        <scale>8</scale>
    </formulas>
    <formulas>
        <name>NewOriginalRenewalMRR</name>
        <dataType>Currency</dataType>
        <expression>{!Renewal_Opp.Original_Renewal_Amount__c} + {!Upsell_Opp.MRR_from_Products__c}</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>NewQuantity</name>
        <dataType>Number</dataType>
        <expression>{!LV_Renewal_OLI.Quantity}+{!LV_Upsell_OLI.Quantity}</expression>
        <scale>4</scale>
    </formulas>
    <formulas>
        <description>Returns True if conditions for merging products are met:
Discount is non-recurring on both Renewal and Upsell OLIs AND Default Price of the Upsell OLI is the same as Default Price and Sales Price of the Renewal OLI.</description>
        <name>NonRecurringDiscountMergeCondition</name>
        <dataType>Boolean</dataType>
        <expression>AND(
ISPICKVAL({!LV_Upsell_OLI.Recurring_Discount__c}, &quot;No&quot;), 
{!LV_Upsell_OLI.Default_Price__c} = {!LV_Renewal_OLI.Default_Price__c}, 
{!LV_Upsell_OLI.Default_Price__c} = {!LV_Renewal_OLI.UnitPrice},
{!LV_Upsell_OLI.UnitPrice} = {!LV_Renewal_OLI.Original_Price__c}
)</expression>
    </formulas>
    <formulas>
        <name>NowPlus1sec</name>
        <dataType>DateTime</dataType>
        <expression>NOW()+ 0.000011</expression>
    </formulas>
    <formulas>
        <name>OLIDiscountAmount</name>
        <dataType>Currency</dataType>
        <expression>IF (ISPICKVAL({!LV_Upsell_OLI.Recurring_Discount__c}, &quot;No&quot;), 0,{!LV_Upsell_OLI.Discount_Amount__c} )</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>OLIRecurringDiscount</name>
        <dataType>String</dataType>
        <expression>IF({!LV_Upsell_OLI.UnitPrice} = {!LV_Upsell_OLI.Default_Price__c}, &quot;&quot;, IF (ISPICKVAL ({!LV_Upsell_OLI.Recurring_Discount__c}, &quot;Yes&quot;), &quot;Yes&quot;, &quot;&quot;))</expression>
    </formulas>
    <formulas>
        <name>OLIRenewalDiscount</name>
        <dataType>Number</dataType>
        <expression>IF (ISPICKVAL ({!LV_Upsell_OLI.Recurring_Discount__c}, &quot;No&quot;), 0, ({!LV_Upsell_OLI.Discount} *100))</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>OLISalesPrice</name>
        <dataType>Currency</dataType>
        <expression>IF (TEXT({!LV_Upsell_OLI.Recurring_Discount__c}) &lt;&gt; &quot;No&quot;, {!LV_Upsell_OLI.UnitPrice}, {!LV_Upsell_OLI.Default_Price__c})</expression>
        <scale>8</scale>
    </formulas>
    <formulas>
        <name>OLISalesPriceARR</name>
        <dataType>Currency</dataType>
        <expression>{!OLISalesPrice}*12</expression>
        <scale>8</scale>
    </formulas>
    <formulas>
        <name>RecurringDiscountMergeCondition</name>
        <dataType>Boolean</dataType>
        <expression>AND(TEXT({!LV_Upsell_OLI.Recurring_Discount__c})  &lt;&gt; &quot;No&quot;,
ABS({!LV_Upsell_OLI.UnitPrice}) = {!LV_Renewal_OLI.Original_Price__c},
OR({!LV_Upsell_OLI.UnitPrice} = {!LV_Renewal_OLI.Default_Price__c}, (-{!LV_Upsell_OLI.UnitPrice}) = {!LV_Renewal_OLI.Default_Price__c}),
OR({!LV_Upsell_OLI.UnitPrice} = {!LV_Renewal_OLI.UnitPrice}, (-{!LV_Upsell_OLI.UnitPrice}) = {!LV_Renewal_OLI.UnitPrice})
)</expression>
    </formulas>
    <formulas>
        <name>RenewalOLIMinCommit</name>
        <dataType>Boolean</dataType>
        <expression>{!LV_Renewal_OLI.Part_of_Min_Commit__c}</expression>
    </formulas>
    <formulas>
        <name>RenewalStartDate</name>
        <dataType>Date</dataType>
        <expression>{!Upsell_Opp.End_date_contract__c}+1</expression>
    </formulas>
    <formulas>
        <name>TODAYPLUS180DAYS</name>
        <dataType>Date</dataType>
        <expression>{!$Flow.CurrentDate} + 180</expression>
    </formulas>
    <formulas>
        <name>Updatecounterplus1</name>
        <dataType>Number</dataType>
        <expression>1+{!UpdateCounter}</expression>
        <scale>0</scale>
    </formulas>
    <formulas>
        <description>Defines the default price of upsell OLI based on the price uplift on renewal.</description>
        <name>upliftedUpsellDefaultPrice</name>
        <dataType>Currency</dataType>
        <expression>IF(TEXT({!Renewal_Opp.Price_Uplift_On_Renewal__c})=&apos;Yes&apos;,{!LV_Upsell_OLI.Default_Price__c} + {!LV_Upsell_OLI.Default_Price__c}*0.05,{!LV_Upsell_OLI.Default_Price__c})</expression>
        <scale>8</scale>
    </formulas>
    <formulas>
        <description>Defines the sales price of upsell OLI based on the price uplift on renewal.</description>
        <name>upliftedUpsellSalesPrice</name>
        <dataType>Currency</dataType>
        <expression>IF(TEXT({!Renewal_Opp.Price_Uplift_On_Renewal__c})=&apos;Yes&apos;,{!LV_Upsell_OLI.UnitPrice} + {!LV_Upsell_OLI.UnitPrice}*0.05,{!LV_Upsell_OLI.UnitPrice})</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>UpsellOLIMinCommit</name>
        <dataType>Boolean</dataType>
        <expression>{!LV_Upsell_OLI.Part_of_Min_Commit__c}</expression>
    </formulas>
    <interviewLabel>Add Upsell to Renewal {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Add Upsell to Renewal</label>
    <loops>
        <name>Loop_Renewal_OLI</name>
        <label>Loop Renewal OLI</label>
        <locationX>1586</locationX>
        <locationY>334</locationY>
        <assignNextValueToReference>LV_Renewal_OLI</assignNextValueToReference>
        <collectionReference>CV_Renewal_OLI</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Product_Check</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Products_Updated</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_Upsell_OLI</name>
        <label>Loop Upsell OLI</label>
        <locationX>1060</locationX>
        <locationY>333</locationY>
        <assignNextValueToReference>LV_Upsell_OLI</assignNextValueToReference>
        <collectionReference>CV_Upsell_OLI</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Loop_Renewal_OLI</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Pause_for_1_second_0</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Create_New_OLI</name>
        <label>Create New OLI</label>
        <locationX>1051</locationX>
        <locationY>626</locationY>
        <connector>
            <targetReference>Update_OLIs</targetReference>
        </connector>
        <inputReference>CV_NewOLI</inputReference>
    </recordCreates>
    <recordDeletes>
        <name>Delete_OLIs</name>
        <label>Delete OLIs</label>
        <locationX>1060</locationX>
        <locationY>1014</locationY>
        <connector>
            <targetReference>Update_Renewal</targetReference>
        </connector>
        <inputReference>OLI_to_Delete</inputReference>
    </recordDeletes>
    <recordLookups>
        <name>Get_Renewal_Products</name>
        <label>Get Renewal Products</label>
        <locationX>679</locationX>
        <locationY>345</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Pause_for_1_second</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>OpportunityId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Renewal_Opp.Id</elementReference>
            </value>
        </filters>
        <object>OpportunityLineItem</object>
        <outputReference>CV_Renewal_OLI</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>PricebookEntryId</queriedFields>
        <queriedFields>Quantity</queriedFields>
        <queriedFields>UnitPrice</queriedFields>
        <queriedFields>Discount</queriedFields>
        <queriedFields>Discount_percentage__c</queriedFields>
        <queriedFields>Default_Price__c</queriedFields>
        <queriedFields>Recurring_Discount__c</queriedFields>
        <queriedFields>TotalPrice</queriedFields>
        <queriedFields>Part_of_a_package__c</queriedFields>
        <queriedFields>Cannot_Delete_From_Package__c</queriedFields>
        <queriedFields>Sales_Price_ARR__c</queriedFields>
        <queriedFields>Original_Price__c</queriedFields>
        <queriedFields>Default_Price_ARR__c</queriedFields>
        <queriedFields>Part_of_Min_Commit__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Upsell_OLIs</name>
        <label>Get UPSELL OLIs</label>
        <locationX>316</locationX>
        <locationY>670</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Contains_MRR</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>For_Renewal__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Included_in_renewal__c</field>
            <operator>EqualTo</operator>
            <value>
                <numberValue>1.0</numberValue>
            </value>
        </filters>
        <filters>
            <field>OpportunityId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>VarT_UpsellOpportunityId</elementReference>
            </value>
        </filters>
        <object>OpportunityLineItem</object>
        <outputReference>CV_Upsell_OLI</outputReference>
        <queriedFields>OpportunityId</queriedFields>
        <queriedFields>Quantity</queriedFields>
        <queriedFields>UnitPrice</queriedFields>
        <queriedFields>Name</queriedFields>
        <queriedFields>Discount_Amount__c</queriedFields>
        <queriedFields>Recurring_Discount__c</queriedFields>
        <queriedFields>Discount</queriedFields>
        <queriedFields>Description</queriedFields>
        <queriedFields>Line_Item_ID_18_digits__c</queriedFields>
        <queriedFields>Product2Id</queriedFields>
        <queriedFields>PricebookEntryId</queriedFields>
        <queriedFields>Discount_percentage__c</queriedFields>
        <queriedFields>Default_Price__c</queriedFields>
        <queriedFields>TotalPrice</queriedFields>
        <queriedFields>Part_of_a_package__c</queriedFields>
        <queriedFields>Cannot_Delete_From_Package__c</queriedFields>
        <queriedFields>Sales_Price_ARR__c</queriedFields>
        <queriedFields>Default_Price_ARR__c</queriedFields>
        <queriedFields>Part_of_Min_Commit__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Related_Renewal</name>
        <label>Related Renewal</label>
        <locationX>316</locationX>
        <locationY>476</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Upsell_OLIs</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Account_ID_18_digits__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Upsell_Opp.Account_ID_18_digits__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Platform__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Upsell_Opp.Platform__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Startdate_contract__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>RenewalStartDate</elementReference>
            </value>
        </filters>
        <filters>
            <field>Type</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Existing Business-Renewal</stringValue>
            </value>
        </filters>
        <object>Opportunity</object>
        <outputReference>Renewal_Opp</outputReference>
        <queriedFields>Contract_IsActive__c</queriedFields>
        <queriedFields>StageName</queriedFields>
        <queriedFields>Opportunity_ID_18_digits__c</queriedFields>
        <queriedFields>Pricebook2Id</queriedFields>
        <queriedFields>CurrencyIsoCode</queriedFields>
        <queriedFields>Close_Date_in_the_past__c</queriedFields>
        <queriedFields>Original_Renewal_Amount__c</queriedFields>
        <queriedFields>Price_Uplift_On_Renewal__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Upsell</name>
        <label>Upsell</label>
        <locationX>313</locationX>
        <locationY>263</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Products_being_merged_check</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Opportunity_ID_18_digits__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>VarT_UpsellOpportunityId</elementReference>
            </value>
        </filters>
        <object>Opportunity</object>
        <outputReference>Upsell_Opp</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Account_ID_18_digits__c</queriedFields>
        <queriedFields>End_date_contract__c</queriedFields>
        <queriedFields>Platform__c</queriedFields>
        <queriedFields>Products_being_merged_to_renewal__c</queriedFields>
        <queriedFields>MRR_from_Products__c</queriedFields>
    </recordLookups>
    <recordUpdates>
        <name>False_Allow_Product_Merge</name>
        <label>False Allow Product Merge</label>
        <locationX>1254</locationX>
        <locationY>1054</locationY>
        <connector>
            <targetReference>Products_Being_Merged_0</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Opportunity_ID_18_digits__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Renewal_Opp.Opportunity_ID_18_digits__c</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Allow_Product_Merge__c</field>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Close_Date_in_the_past__c</field>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputAssignments>
        <object>Opportunity</object>
    </recordUpdates>
    <recordUpdates>
        <name>True_Allow_Product_Merge_Update</name>
        <label>True Allow Product Merge</label>
        <locationX>747</locationX>
        <locationY>486</locationY>
        <connector>
            <targetReference>Products_Being_Merged</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Opportunity_ID_18_digits__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Renewal_Opp.Opportunity_ID_18_digits__c</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Allow_Product_Merge__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Close_Date_in_the_past__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <object>Opportunity</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_OLIs</name>
        <label>Update OLIs</label>
        <locationX>1051</locationX>
        <locationY>744</locationY>
        <connector>
            <targetReference>OLIs_to_delete</targetReference>
        </connector>
        <inputReference>OLI_to_Update</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Renewal</name>
        <label>Update Renewal</label>
        <locationX>1249</locationX>
        <locationY>964</locationY>
        <connector>
            <targetReference>False_Allow_Product_Merge</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Renewal_Opp.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Original_Renewal_Amount__c</field>
            <value>
                <elementReference>NewOriginalRenewalMRR</elementReference>
            </value>
        </inputAssignments>
        <object>Opportunity</object>
    </recordUpdates>
    <start>
        <locationX>187</locationX>
        <locationY>145</locationY>
        <connector>
            <targetReference>Upsell</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <name>CV_NewOLI</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <name>CV_Renewal_OLI</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <name>CV_Upsell_OLI</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <name>LV_Renewal_OLI</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <name>LV_Upsell_OLI</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <name>NEWOLI</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <name>OLI_to_Delete</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <name>OLI_to_Update</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <name>PriceBookEntryID</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>PricebookEntry</objectType>
    </variables>
    <variables>
        <name>Renewal_Opp</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>Opportunity</objectType>
    </variables>
    <variables>
        <name>UpdateCounter</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>Upsell_Opp</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Opportunity</objectType>
    </variables>
    <variables>
        <name>VarT_UpsellOpportunityId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <waits>
        <name>Pause_for_1_second</name>
        <label>Pause for 1 second</label>
        <locationX>910</locationX>
        <locationY>333</locationY>
        <defaultConnectorLabel>Default Path</defaultConnectorLabel>
        <waitEvents>
            <name>Pause</name>
            <conditionLogic>and</conditionLogic>
            <connector>
                <targetReference>Loop_Upsell_OLI</targetReference>
            </connector>
            <eventType>AlarmEvent</eventType>
            <inputParameters>
                <name>AlarmTime</name>
                <value>
                    <elementReference>NowPlus1sec</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>TimeOffset</name>
            </inputParameters>
            <inputParameters>
                <name>TimeOffsetUnit</name>
            </inputParameters>
            <label>Pause</label>
        </waitEvents>
    </waits>
    <waits>
        <name>Pause_for_1_second_0</name>
        <label>Pause for 1 second</label>
        <locationX>1053</locationX>
        <locationY>481</locationY>
        <defaultConnectorLabel>Default Path</defaultConnectorLabel>
        <waitEvents>
            <name>Pause_0</name>
            <conditionLogic>and</conditionLogic>
            <connector>
                <targetReference>Create_New_OLI</targetReference>
            </connector>
            <eventType>AlarmEvent</eventType>
            <inputParameters>
                <name>AlarmTime</name>
                <value>
                    <elementReference>NowPlus1sec</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>TimeOffset</name>
            </inputParameters>
            <inputParameters>
                <name>TimeOffsetUnit</name>
            </inputParameters>
            <label>Pause</label>
        </waitEvents>
    </waits>
</Flow>
