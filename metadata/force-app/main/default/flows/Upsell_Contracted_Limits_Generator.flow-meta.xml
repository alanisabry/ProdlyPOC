<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>63.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>Add_Contracted_Limit_Variable_to_Collection</name>
        <label>Add Contracted Limit Variable to Collection</label>
        <locationX>1700</locationX>
        <locationY>890</locationY>
        <assignmentItems>
            <assignToReference>varContractedLimitToUpdateCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>varContractedLimitToUpdate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_through_current_contracted_Limits</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_First_Cumulative_Limit_to_Collection</name>
        <label>Add First Cumulative Limit to Collection</label>
        <locationX>1964</locationX>
        <locationY>1214</locationY>
        <assignmentItems>
            <assignToReference>varSameYearCumulativeLimitsCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>varSameYearCumulativeLimittoUpdate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_through_current_contracted_Limits</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_First_Month_Contracted_Limit_Variable_to_Collection</name>
        <label>Add First Month Contracted Limit Variable to Collection</label>
        <locationX>1436</locationX>
        <locationY>890</locationY>
        <assignmentItems>
            <assignToReference>varContractedLimitToUpdateCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>varContractedLimitToUpdate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_through_current_contracted_Limits</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_Newly_Created_Cumulative_Limit_To_Collection</name>
        <label>Add Newly Created Cumulative Limit To Collection</label>
        <locationX>1964</locationX>
        <locationY>998</locationY>
        <assignmentItems>
            <assignToReference>varContractedLimitToCreateCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>varContractedLimitToCreate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Same_Year_Cumulative_Limit</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_Updated_Cumulative_Limit_to_Collection</name>
        <label>Add Updated Cumulative Limit to Collection</label>
        <locationX>2228</locationX>
        <locationY>998</locationY>
        <assignmentItems>
            <assignToReference>varDifferentYearCumulativeLimitCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>varDifferentYearCumulativeLimittoUpdate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_through_current_contracted_Limits</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Create_New_Cumulative_Contracted_Limit</name>
        <label>Create New Cumulative Contracted Limit</label>
        <locationX>1964</locationX>
        <locationY>890</locationY>
        <assignmentItems>
            <assignToReference>varContractedLimitToCreate.Account__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_current_contracted_Limits.Account__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varContractedLimitToCreate.Latest_Amendment_Opportunity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_Contracted_Limits.opportunity_Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varContractedLimitToCreate.Latest_Amendment_Opportunity_Product__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_Contracted_Limits.oli_Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varContractedLimitToCreate.Limit__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_current_contracted_Limits.Limit__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varContractedLimitToCreate.Original_Opportunity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_current_contracted_Limits.Original_Opportunity__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varContractedLimitToCreate.Original_Opportunity_Product__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_current_contracted_Limits.Original_Opportunity_Product__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varContractedLimitToCreate.Term_of_Contract__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_current_contracted_Limits.Term_of_Contract__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varContractedLimitToCreate.Month_of_Term__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_current_contracted_Limits.Month_of_Term__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varContractedLimitToCreate.Value__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_Contracted_Limits.annual_limit_value</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varContractedLimitToCreate.Start_Date__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_Contracted_Limits.opp_start_date</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varContractedLimitToCreate.End_Date__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_current_contracted_Limits.End_Date__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_Newly_Created_Cumulative_Limit_To_Collection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Empty_Collection</name>
        <label>Empty Collection</label>
        <locationX>1216</locationX>
        <locationY>1874</locationY>
        <assignmentItems>
            <assignToReference>varContractedLimitToUpdateCollection</assignToReference>
            <operator>RemoveAll</operator>
            <value>
                <elementReference>varContractedLimitToUpdateCollection</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_through_Contracted_Limits</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Update_Contracted_Limit</name>
        <label>Update Contracted Limit</label>
        <locationX>1700</locationX>
        <locationY>782</locationY>
        <assignmentItems>
            <assignToReference>varContractedLimitToUpdate.Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_current_contracted_Limits.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varContractedLimitToUpdate.Latest_Amendment_Opportunity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_Contracted_Limits.opportunity_Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varContractedLimitToUpdate.Latest_Amendment_Opportunity_Product__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_Contracted_Limits.oli_Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varContractedLimitToUpdate.Value__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>varProRatedLimitValue</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_Contracted_Limit_Variable_to_Collection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Update_Contracted_Limit_First_Month</name>
        <label>Update Contracted Limit - First Month</label>
        <locationX>1436</locationX>
        <locationY>782</locationY>
        <assignmentItems>
            <assignToReference>varContractedLimitToUpdate.Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_current_contracted_Limits.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varContractedLimitToUpdate.Latest_Amendment_Opportunity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_Contracted_Limits.opportunity_Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varContractedLimitToUpdate.Latest_Amendment_Opportunity_Product__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_Contracted_Limits.oli_Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varContractedLimitToUpdate.Value__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>varProRatedLimitValueFirstMonth</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_First_Month_Contracted_Limit_Variable_to_Collection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Update_Cumulative_Limit_Value</name>
        <label>Update Cumulative Limit Value</label>
        <locationX>2228</locationX>
        <locationY>890</locationY>
        <assignmentItems>
            <assignToReference>varDifferentYearCumulativeLimittoUpdate.Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_current_contracted_Limits.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varDifferentYearCumulativeLimittoUpdate.Latest_Amendment_Opportunity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_Contracted_Limits.opportunity_Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varDifferentYearCumulativeLimittoUpdate.Latest_Amendment_Opportunity_Product__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_Contracted_Limits.oli_Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varDifferentYearCumulativeLimittoUpdate.Value__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_Contracted_Limits.annual_limit_value</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_Updated_Cumulative_Limit_to_Collection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Update_Same_Year_Cumulative_Limit</name>
        <label>Update Same Year Cumulative Limit</label>
        <locationX>1964</locationX>
        <locationY>1106</locationY>
        <assignmentItems>
            <assignToReference>varSameYearCumulativeLimittoUpdate.Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_current_contracted_Limits.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varSameYearCumulativeLimittoUpdate.End_Date__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>varOneDayBefore</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varSameYearCumulativeLimittoUpdate.Latest_Amendment_Opportunity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_Contracted_Limits.opportunity_Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varSameYearCumulativeLimittoUpdate.Latest_Amendment_Opportunity_Product__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_through_Contracted_Limits.oli_Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_First_Cumulative_Limit_to_Collection</targetReference>
        </connector>
    </assignments>
    <collectionProcessors>
        <name>Sort_Per_Quantity</name>
        <elementSubtype>SortCollectionProcessor</elementSubtype>
        <label>Sort Per Quantity</label>
        <locationX>182</locationX>
        <locationY>134</locationY>
        <collectionProcessorType>SortCollectionProcessor</collectionProcessorType>
        <collectionReference>varContractedYearlyLimitsCollection</collectionReference>
        <connector>
            <targetReference>Loop_through_Contracted_Limits</targetReference>
        </connector>
        <sortOptions>
            <doesPutEmptyStringAndNullFirst>false</doesPutEmptyStringAndNullFirst>
            <sortField>qty</sortField>
            <sortOrder>Asc</sortOrder>
        </sortOptions>
    </collectionProcessors>
    <decisions>
        <name>Different_Year_Cumulative_Limit_Collection_NOT_NULL</name>
        <label>Different Year Cumulative Limit Collection NOT NULL</label>
        <locationX>182</locationX>
        <locationY>2450</locationY>
        <defaultConnector>
            <targetReference>Limits_to_Create_Collection_NOT_NULL</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>NO</defaultConnectorLabel>
        <rules>
            <name>YES_Different_Year_Cumulative_Limit_Collection_NOT_NULL</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>varDifferentYearCumulativeLimitCollection</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Different_Year_Cumulative_Limits</targetReference>
            </connector>
            <label>YES</label>
        </rules>
    </decisions>
    <decisions>
        <name>Limit_in_Same_Year</name>
        <label>Limit in Same Year?</label>
        <locationX>2096</locationX>
        <locationY>782</locationY>
        <defaultConnector>
            <targetReference>Update_Cumulative_Limit_Value</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>NO</defaultConnectorLabel>
        <rules>
            <name>YES_Limit_in_Same_Year</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>varSameYear</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Create_New_Cumulative_Contracted_Limit</targetReference>
            </connector>
            <label>YES</label>
        </rules>
    </decisions>
    <decisions>
        <name>Limit_Type</name>
        <label>Limit Type</label>
        <locationX>1931</locationX>
        <locationY>566</locationY>
        <defaultConnector>
            <targetReference>Positive_Quantity</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Cumulative</defaultConnectorLabel>
        <rules>
            <name>Time_Based</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Loop_through_current_contracted_Limits.Limit__r.Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Time Based Limit</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Same_Month</targetReference>
            </connector>
            <label>Time Based</label>
        </rules>
    </decisions>
    <decisions>
        <name>Limits_to_Create_Collection_NOT_NULL</name>
        <label>Limits to Create Collection NOT NULL</label>
        <locationX>182</locationX>
        <locationY>2750</locationY>
        <defaultConnectorLabel>NO</defaultConnectorLabel>
        <rules>
            <name>YES_Limits_to_Create_Collection_NOT_NULL</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>varContractedLimitToCreateCollection</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Create_New_Cumulative_Limits</targetReference>
            </connector>
            <label>YES</label>
        </rules>
    </decisions>
    <decisions>
        <name>Limits_to_Update_Collection_NOT_NULL</name>
        <label>Limits to Update Collection NOT NULL</label>
        <locationX>1348</locationX>
        <locationY>1658</locationY>
        <defaultConnector>
            <targetReference>Loop_through_Contracted_Limits</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>NO</defaultConnectorLabel>
        <rules>
            <name>YES_Limits_to_Update_Collection_NOT_NULL</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>varContractedLimitToUpdateCollection</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Current_Contracted_Limits</targetReference>
            </connector>
            <label>YES</label>
        </rules>
    </decisions>
    <decisions>
        <name>Positive_Quantity</name>
        <label>Positive Quantity?</label>
        <locationX>2294</locationX>
        <locationY>674</locationY>
        <defaultConnector>
            <targetReference>Loop_through_current_contracted_Limits</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>NO</defaultConnectorLabel>
        <rules>
            <name>YES_Positive_Quantity</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Loop_through_Contracted_Limits.qty</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Limit_in_Same_Year</targetReference>
            </connector>
            <label>YES</label>
        </rules>
    </decisions>
    <decisions>
        <name>Same_Month</name>
        <label>Same Month?</label>
        <locationX>1568</locationX>
        <locationY>674</locationY>
        <defaultConnector>
            <targetReference>Update_Contracted_Limit</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>NO</defaultConnectorLabel>
        <rules>
            <name>YES_Same_Month</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>varSameMonth</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Contracted_Limit_First_Month</targetReference>
            </connector>
            <label>YES</label>
        </rules>
    </decisions>
    <decisions>
        <name>Same_Year_Cumulative_Limit_Collection_NOT_NULL</name>
        <label>Same Year Cumulative Limit Collection NOT NULL</label>
        <locationX>182</locationX>
        <locationY>2150</locationY>
        <defaultConnector>
            <targetReference>Different_Year_Cumulative_Limit_Collection_NOT_NULL</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>NO</defaultConnectorLabel>
        <rules>
            <name>YES_Same_Year_Cumulative_Limit_Collection_NOT_NULL</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>varSameYearCumulativeLimitsCollection</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Same_Year_Cumulative_Limits</targetReference>
            </connector>
            <label>YES</label>
        </rules>
    </decisions>
    <environments>Default</environments>
    <formulas>
        <name>varOneDayBefore</name>
        <dataType>Date</dataType>
        <expression>{!Loop_through_Contracted_Limits.opp_start_date}-1</expression>
    </formulas>
    <formulas>
        <name>varProRatedLimitValue</name>
        <dataType>Number</dataType>
        <expression>ROUND(
(({!Loop_through_Contracted_Limits.annual_limit_value}*{!Loop_through_Contracted_Limits.qty})/365)*(({!Loop_through_current_contracted_Limits.End_Date__c}- {!Loop_through_current_contracted_Limits.Start_Date__c})+1),3)
+ {!Loop_through_current_contracted_Limits.Value__c}</expression>
        <scale>0</scale>
    </formulas>
    <formulas>
        <name>varProRatedLimitValueFirstMonth</name>
        <dataType>Number</dataType>
        <expression>ROUND(
(({!Loop_through_Contracted_Limits.annual_limit_value}*{!Loop_through_Contracted_Limits.qty})/365)*(({!Loop_through_current_contracted_Limits.End_Date__c}- {!Loop_through_Contracted_Limits.opp_start_date})+1),3)
+ {!Loop_through_current_contracted_Limits.Value__c}</expression>
        <scale>0</scale>
    </formulas>
    <formulas>
        <name>varSameMonth</name>
        <dataType>Boolean</dataType>
        <expression>(
MONTH({!Loop_through_current_contracted_Limits.End_Date__c}) = MONTH({!Loop_through_Contracted_Limits.opp_start_date})
)
&amp;&amp; 
(
YEAR({!Loop_through_current_contracted_Limits.End_Date__c}) = 
YEAR({!Loop_through_Contracted_Limits.opp_start_date})
)</expression>
    </formulas>
    <formulas>
        <name>varSameYear</name>
        <dataType>Boolean</dataType>
        <expression>YEAR({!Loop_through_Contracted_Limits.opp_start_date})=YEAR({!Loop_through_current_contracted_Limits.Start_Date__c})</expression>
    </formulas>
    <interviewLabel>Upsell Contracted Limits Generator {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Upsell Contracted Limits Generator</label>
    <loops>
        <name>Loop_through_Contracted_Limits</name>
        <label>Loop through Contracted Limits</label>
        <locationX>182</locationX>
        <locationY>242</locationY>
        <collectionReference>varContractedYearlyLimitsCollection</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Get_Related_Contracted_Limits_Records</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Same_Year_Cumulative_Limit_Collection_NOT_NULL</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_through_current_contracted_Limits</name>
        <label>Loop through current contracted Limits</label>
        <locationX>1348</locationX>
        <locationY>458</locationY>
        <collectionReference>Get_Related_Contracted_Limits_Records</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Limit_Type</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Limits_to_Update_Collection_NOT_NULL</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Create_New_Cumulative_Limits</name>
        <label>Create New Cumulative Limits</label>
        <locationX>50</locationX>
        <locationY>2858</locationY>
        <inputReference>varContractedLimitToCreateCollection</inputReference>
    </recordCreates>
    <recordLookups>
        <name>Get_Related_Contracted_Limits_Records</name>
        <label>Get Related Contracted Limits Records</label>
        <locationX>1348</locationX>
        <locationY>350</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_through_current_contracted_Limits</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Account__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Loop_through_Contracted_Limits.account_Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Limit__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Loop_through_Contracted_Limits.limit_Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>End_Date__c</field>
            <operator>GreaterThan</operator>
            <value>
                <elementReference>Loop_through_Contracted_Limits.opp_start_date</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Contracted_Limit__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_Current_Contracted_Limits</name>
        <label>Update Current Contracted Limits</label>
        <locationX>1216</locationX>
        <locationY>1766</locationY>
        <connector>
            <targetReference>Empty_Collection</targetReference>
        </connector>
        <inputReference>varContractedLimitToUpdateCollection</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Different_Year_Cumulative_Limits</name>
        <label>Update Different Year Cumulative Limits</label>
        <locationX>50</locationX>
        <locationY>2558</locationY>
        <connector>
            <targetReference>Limits_to_Create_Collection_NOT_NULL</targetReference>
        </connector>
        <inputReference>varDifferentYearCumulativeLimitCollection</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Same_Year_Cumulative_Limits</name>
        <label>Update Same Year Cumulative Limits</label>
        <locationX>50</locationX>
        <locationY>2258</locationY>
        <connector>
            <targetReference>Different_Year_Cumulative_Limit_Collection_NOT_NULL</targetReference>
        </connector>
        <inputReference>varSameYearCumulativeLimitsCollection</inputReference>
    </recordUpdates>
    <start>
        <locationX>56</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Sort_Per_Quantity</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <name>varContractedLimitToCreate</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contracted_Limit__c</objectType>
    </variables>
    <variables>
        <name>varContractedLimitToCreateCollection</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contracted_Limit__c</objectType>
    </variables>
    <variables>
        <name>varContractedLimitToUpdate</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contracted_Limit__c</objectType>
    </variables>
    <variables>
        <name>varContractedLimitToUpdateCollection</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contracted_Limit__c</objectType>
    </variables>
    <variables>
        <name>varContractedYearlyLimitsCollection</name>
        <apexClass>ContractLimitMainClass</apexClass>
        <dataType>Apex</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>varDifferentYearCumulativeLimitCollection</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contracted_Limit__c</objectType>
    </variables>
    <variables>
        <name>varDifferentYearCumulativeLimittoUpdate</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contracted_Limit__c</objectType>
    </variables>
    <variables>
        <name>varSameYearCumulativeLimitsCollection</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contracted_Limit__c</objectType>
    </variables>
    <variables>
        <name>varSameYearCumulativeLimittoUpdate</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contracted_Limit__c</objectType>
    </variables>
</Flow>
